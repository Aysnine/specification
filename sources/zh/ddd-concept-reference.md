---
title: DDD 概念参考
numbersections: true
---

# 通用类概念

## 领域驱动设计（DDD）

**DDD 是 Domain-Driven Design 的缩写，是 Eric Evans 于 2004 年提出的一种软件设计方法和理念。**

其主要的思想是，利用确定的业务模型来指导业务与应用的设计和实现。主张开发人员与业务人员持续地沟通和模型的持续迭代式演化，以保证业务模型与代码实现的一致性，从而实现有效管理业务复杂度，优化软件设计的目的。

## 模型 (Model)

**通常，模型是对对象、人或系统的信息表示。它通过较为简单的信息结构来代表我们需要理解的复杂事物或系统。**

地图、乐高、算筹都是模型，模型可以简化复杂事务的认知。我们天生就有用简单的东西代表另外一个东西的能力，比如幼儿园数数用的竹签，学习物理时的刚体、真空中的球形鸡，都是模型。通俗来说模型就是经验的抽象集合，平时听到的谚语、公式、定理，本质上都是一种模型。

## 建模 (Modeling)

**建模是构建模型的过程。**

在软件设计过程中，通过分析业务，将业务需求使用合适的模型表示出来，是建模的任务。模型可以作为业务分析的产出，并作为软件设计的重要理论基础。
比如在分析一个电商应用的业务时，抽象出订单、商品等概念，进一步定义出模型，并用合适的图例表达，往往是 UML 来表达。

## 模型驱动设计（Model-Driven Design）

**面向模型的分析设计方法，优先通过识别模型来简化业务设计。**

在设计过程中，以模型为中心，始终维护模型，并基于此指导软件设计。

## 软件设计（The Software Design）

****
TODO  

## 战略设计（Strategic Design）

**战略设计也称为战略建模，是指对业务进行高层次的抽象和归类。主要手段包括理清上下文和进行子域的划分。**

战略设计关注模型的分离，其解决的问题是大的模型如何划分为小模型以及相互之间如何关联。战略设计的产出可以用于指导团队协作，使得规模巨大的软件可以被合理拆分。

战略设计的产出通常为上下文图，以及模块或微服务划分。

## 战术设计 (Tactical design)

**战略设计也称为战术建模，是指对特定上下文下的模型进行详细设计。**

战术设计的对象包括聚合、实体和值对象，其目标是用明确它们是什么以及相互之间有何关系。战术设计的产出可以是用 UML 表达的类图，需要细化到具体的属性，同时确保在代码级别可实现。

## 软件 (Software)

**DDD 讨论下的软件是指，用于解决具体业务问题的计算机程序，既可以是单体也可以是分布式系统。** 

软件设计是 DDD 的最终目的，使用 DDD 的各种工具可以指导软件设计，最终构建出健壮、容易维护的软件。

## 原则（Principle）

**为了更好的践行 DDD，需要遵守几个原则: 通用语言、聚焦核心域、协作共创和持续建模。**

这些原则是为了更好地服务业务，从业务驱动模型设计。 

## 通用语言（Ubiquitous）

**通用语言（Ubiquitous language）是指在软件设计中，业务人员和开发人员需要使用无歧义的统一语言来对话。**

这些语言包括对概念的统一理解和定义，以及业务人员参与到软件建模中，否则业务的变化会造成软件巨大的变化。

## 聚焦核心域 (Focus)

**核心域就是最关键的业务逻辑，聚焦核心域决定了软件的定位和投资重心。**

## 协作共创 (Collaboration)

**协作共创是指领域专家和业务专家共同建模。**

## 持续建模 (Continuous)

**持续建模是指模型需要随业务变化而被及时更新，同时在实现细节上也不能固守模型。**

## 上下文（Context）

**上下文是语言学科的概念，指不同语境下的概念虽然相同的用词，可能具有不同的含义。**

在软件设计中，因为自然语言的原因，相同的用词导致实际是不同概念，会对建模和软件设计带来误导。同时，不同的上下文也是识别模型边界的手段。

# 领域分析类概念

## 问题空间 (Problem Space)

**问题空间是一个数学概念，在 DDD 的论域下意为待解决的业务问题的集合。**

领域分析的相关概念都在问题空间，问题空间是相对于解空间而言的。意识到问题空间的存在，可以避免过早下结论，或直接得到解决方案。

## 领域（Domain）

**领域（Domain）是软件要解决的业务问题和诉求。**

通俗来说，领域就是业务需求。不过这些业务有一些内在逻辑需要分析，存在一些专业性，比如财务、CRM、OA、电商等不同领域。计算机只是自动化的处理领域问题，领域知识可能不是开发人员擅长的。

## 子域 (Sub Domain)

**一个子域是领域的部分。**

为了降低一个软件需要解决的业务复杂度，将领域划分为子域，通过分而治之的方法分析问题。

## 核心域 (Core Domain)

**核心域是指领域中最核心的部分，往往是一个企业赖以存在的业务**

核心域是我们必须尽最大努力的地方，核心域也是我们需要充分分析和投入最大的投资的地方，也是一个企业能运转的最小集。

## 支撑域 (Support Domain)

**支撑域是指为了实现核心业务而不得不开发的业务。**

例如，活动平台是电商的支撑域，虽然不是必不可少的部分，但是能活动平台能支撑电商业务，并放大利润。

## 通用域 (General Domain)

**通用域是指业界已经有成熟的业务方案，并能采购和外包到现有的 IT 设施。**

通用域可以看做一种特殊的支撑域，可以使用标准部件来实现，短信通知、邮件等领域问题。


# 建模类概念

## 解空间 (Solution Space)

**解空间是一个数学概念，在 DDD 的论域下意为解决方案的集合。**

解空间是相对问题空间存在的，认识到解空间存在的好处是解空间可以通过一些方法从问题空间导出，而不是通过猜测得出的。

## 领域模型（Model）

**领域模型（Model）是业务概念在程序中的一种表达方式。**

面向对象的编程语言使用类作为业务概念的承载体，也可以用 UML 可视化的表达模型。模型是用来设计和理解整个软件结构，切记不要事无巨细的模型。在模型思维中，模型是简单的，能反应业务概念即可。

## 限界上下文（ Bounded context）

**限界上下文是一个显式边界（边界：通常是一个子系统或者一个特定团队的工作），领域模型存在于边界之内。建立模型过程中形成了通用语言，通用语言在特定上下文中才有明确的意义。**

限界上下文强调概念的一致性。虽然传统的方法学已经在追求概念的一致性，但是忽略了系统的庞大性，不论系统多庞大，在系统任何位置同一概念通用。DDD不追求全局的一致性，而是将系统拆成多块，在相同的上下文中实现概念一致性。

识别上下文可以从概念的二义性着手，比如商品的概念在物流、交易、支付含义完全不一样，但具有不同内涵和外延，实际上他们处在不同上下文。

界限上下文可以用于微服务划分、避免模型的不正确复用带来的问题。

## 实体（Entity）

**实体（Entity）是在相同上下文中具有唯一标识的领域模型，可变化，通过标识判断同一性。**

领域模型可以是一个广义的概念，建模的结果和中间过程其实都可以看做模型。

## 值对象（Value Object）

**值对象 （Value Ojbect）是一种特殊的领域模型，值对象是以内容判断，不可变，同一性。**

实体可以使用 ID 标识，但是值对象是用属性标识，任何属性的变化都视为新的对象。比如一个银行账户，可以由 ID 唯一标识，币种和余额可以被修改但是还是同一个账户；交易单中的金额由币种和数值组成，无论修改哪一个属性，金额都不再是原来的金额。

## 聚合（Aggregate）

**聚合 （Aggregate）是一组生命周期以及业务规则强一致的实体和值对象的集合，表达统一的业务意义。** 

聚合的意义在于让业务统一、一致，在面向对象中有非常重要价值。聚合是在相同的上下文中，不能跨上下文。

## 聚合根（ Aggregate Root）

**聚合根（ Aggregate Root）是聚合中最核心的实体，其他的实体和值对象都从属于这个实体。**

要管理聚合必须使用一个聚合根，然后使用聚合根来实现发现、持久化聚合的作用，完成统一的业务意义。一个聚合中有且只有一个聚合根，聚合也可以只有一个单独的实体。

# 软件设计类概念

## 模块（Module）

**模块（Module）一组类或者对象组成的集合。** 

模块的划分没有固定的模式，如果不是特别复杂的业务逻辑可以使用上下文划分模块，次一级的包使用对象类型组织即可。

## 仓储（Repository）

**仓储（Repository）是以持久化领域模型为职责的类。** 

仓库的目的是屏蔽业务逻辑和持久化基础设施的差异，由于大部分项目使用关系数据库作为存储基础设施，仓库层大多被 ORM 代为实现，如果不使用 ORM，需要自己实现仓库。

## 服务（Service）

**服务（Service）是领域模型的操作者，承载领域的业务规则。** 

模型用于承载数据和系统状态，业务规则的事情就交给服务，让逻辑更为清晰明了。

## 工厂（Factory）

**工厂（Factory）是以构建领域模型（实体或值对象）为职责的类或方法。**

工厂可以把不同的业务参数转化为领域模型，在简单的业务逻辑中可以不使用工厂，实际工作中工厂不是一个具体的概念，为了简化我们可以把静态工厂方法放到 DOT 或者其他类中。

## 策略（Strategy）

**策略（Strategy）是一些业务规则的不同实现方式。**

例如通知业务，可以使用不同的渠道来实现，不同渠道的实现逻辑可以作为策略完成。

## 规格 (Specification)

**规格 (Specification) 是一些特殊的业务规则，一般表现为计算结果是真或者假的函数。**

规格可以用于业务逻辑的校验、查询条件，一般来说规格是可选的，不过对于复杂的业务抽象出规格可以复用这些业务逻辑。

## 分层架构（逻辑）

**分层架构是指软件在逻辑上的结构，按照 DDD 的分层模型，可以划分为:接入层、应用层、领域层、基础设施层**

分层架构在具体的软件中可以表现为不同的形式，在分布式系统中，可以由接入服务（网关）、应用服务、领域服务、中间件构成，可以对应逻辑上的分层结构。
在单体系统中，可以是不同的模块或包。

## 接入层 (Interface)

**接入层，处理系统输入、输出。** 

对于服务端应用而言，接入层不是指 UI，而是指接入的协议，HTTP、websocket、LDAP 等协议都属于接入层。

## 应用层 (Application)

**应用层，组织业务场景，编排业务，隔离场景对领域层的差异。**

应用层最大的用处是处理业务场景，对应面向对象的思想就是 “关注点分离”。如果是一个用户社区应用，用户面、作者面、后台管理多个面实际是多个应用，而共享一套领域代码，可以做到既能关注点分离，又能复用核心业务逻辑的目的。

## 领域层 (Domain)

**领域层，实现具体的业务逻辑、规则。与核心的业务逻辑强相关，变化速度慢，复用性高的服务能力。** 

实际处理业务的地方，领域层需要对应用层提供无差别的服务和能力。比如用户注册，用户可以通过邮箱自己注册，也可以由管理员在后台应用添加。注册的逻辑需要由领域层完成，但是处理用户输入参数的部分需要由应用层屏蔽。

TODO 无差别的解释

## 基础设施层 (Infrastructure)

**基础设施层，提供具体的技术实现，比如存储，基础设施对业务保持透明。**

 如果无法对领域层提供透明的能力，说明这部分代码不适合放入基础设施层。比如，在使用 JPA 时，Repository 的 Interface 定义，不应该认为是基础设施，而 ORM 对这些 Interface 的实现和具体的 SQL 处理则可以认为是基础设施层的代码。

## 部署架构（物理）

**部署架构是指具体的架构实现**

主要是在分布式系统、单体系统，甚至在客户端软件中体现。

## 微服务 (Micro Service)

**微服务是一种低耦合的分布式应用系统。**

## 单体 (Monomer)

**单体是主要业务实现和部署在单一服务器上的应用。**

## 分布式应用系统 (Distributed)

**分布式应用系统是建立在计算机网络之上的应用软件系统，不同单元通过计算机网络集成。**

# 事件风暴类概念
## 事件风暴（Event Storming）

**事件风暴是一种以工作坊的形式，使用 DDD 建模的方式。**

事件风暴的发明人是 Alberto Brandolini ，它来源于 Gamestorming，通过工作坊的方式将领域专家和技术专家拉到一起，进行建模。

事件风暴是一种捕获行为需求的方法，类似传统软件的开发用例分析。所有人员 (领域专家和技术专家) 对业务行为进行一次发散，并最终收敛达到业务的统一。



## 事件（Event）

**事件是系统状态发生的某种客观现象。**

事件的评价方式是系统状态是否发生变化。系统状态变化意味着领域模型被业务规则操作，这是观察系统业务的好方法。

## 命令 (Command)

**命令是执行者发起的操作，构成要件是执行者和行为。**

## 执行者 (Actor)

**执行者是指操作系统的主体，是导致系统状态变化的触发源。**

执行者有点像 UML 的涉众，不过区别是执行者不仅是用户，还包括外部系统和本系统。
在事件风暴中，执行者可以是：用户、外部系统、本系统、定时器。

## 业务规则 (policy)

**业务规则是指对业务定义和约束的描述，用于维持业务结构和控制、影响业务的行为。**

## 用户 (User)

**作为执行者的概念下的用户，是指使用软件或服务的人。**

## 外部系统 (Out System)

**作为执行者的概念下的外部系统，系统开放 API 的调用发起者。**

## 本系统 (System)

**作为执行者的概念下的系统本身。**

## 定时器 (Timer)

**作为执行者的概念下的定时器或其他定时任务。**

## 参与人 (Participants)

**作为工作坊的参与人员（应区别于执行者）。**

参与人只是一种角色，而非具体的一个人，可以是多个自然人做群体参与，也可以一人分饰不同的角色。

## 领域专家 (Domain Expert)

**领域专家是指熟悉业务规则的人，在工作坊中一般是能敲定业务规则的人。**

## 技术专家 (Tech Expert)

**技术专家是指熟悉技术方案和实现方式的人，能给出可行的技术方案和了解基础设计的限制条件。**

## 主持人 (Facilitator)

**主持人工作坊流程的推动者，以及 DDD 方法论的守护者。**

